{
  "id": "snapshot_1763037606242_kn78h5a64",
  "approvalId": "approval_1763037550746_n69p0llon",
  "approvalTitle": "UAT Readiness Tasks Document - 31 Implementation Tasks",
  "version": 2,
  "timestamp": "2025-11-13T12:40:06.242Z",
  "trigger": "approved",
  "status": "pending",
  "content": "# Tasks: UAT Readiness Implementation\n\n## Overview\nThis document breaks down the UAT Readiness design into atomic, implementable tasks. Each task is estimated for effort, has clear success criteria, and includes an implementation prompt for execution.\n\n**Total Estimated Effort**: ~4-5 weeks (1 developer)\n\n## Task Status Legend\n- `[ ]` - Pending\n- `[-]` - In Progress\n- `[x]` - Completed\n\n---\n\n## Phase 1: Foundation & Dependencies (3 days)\n\n### Task 1.1: Add Project Dependencies\n**Estimate**: 30 minutes\n**Priority**: Critical\n**Files**: `pubspec.yaml`\n\n**Description**: Add new Flutter dependencies for navigation, storage, and testing enhancements.\n\n**Requirements**: US-1, US-3, US-4, US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: DevOps/Build Engineer\n\n**Task**: Add the following dependencies to pubspec.yaml:\n\nDependencies to add:\n- go_router: ^14.6.2\n- shared_preferences: ^2.3.4\n\nAlready present (verify versions):\n- mocktail: ^1.0.4\n- flutter_test (SDK)\n- integration_test (SDK)\n\n**Restrictions**:\n- Do NOT upgrade existing dependencies unnecessarily\n- Verify pubspec.yaml syntax after changes\n- Run `flutter pub get` to validate\n\n**_Leverage**:\n- Existing pubspec.yaml at /home/rmondo/repos/beatbox-trainer/pubspec.yaml\n\n**_Requirements**: US-1 (navigation for onboarding), US-3 (settings storage), US-5 (testing)\n\n**Success**:\n- pubspec.yaml contains all new dependencies\n- `flutter pub get` succeeds without errors\n- No version conflicts reported\n\n**Instructions**:\n1. Mark this task as in-progress in tasks.md (change [ ] to [-])\n2. Implement the changes\n3. Test with `flutter pub get`\n4. Use log-implementation tool to record the changes with artifacts\n5. Mark task as complete in tasks.md (change [-] to [x])\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 1.2: Regenerate Flutter Rust Bridge\n**Estimate**: 15 minutes\n**Priority**: Critical\n**Files**: `rust/src/api.rs`, Dart generated files\n\n**Description**: Ensure FFI bridge is up-to-date before adding new API methods.\n\n**Requirements**: All\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Rust/FFI Integration Engineer\n\n**Task**: Regenerate Flutter Rust Bridge bindings to ensure clean slate.\n\nSteps:\n1. Run `flutter_rust_bridge_codegen generate`\n2. Verify no compilation errors in Rust\n3. Verify no errors in Dart bindings\n4. Commit generated files\n\n**Restrictions**:\n- Do NOT modify rust/src/api.rs manually before regenerating\n- Verify bridge_generated.rs and frb_generated.dart compile\n\n**_Leverage**:\n- Existing FFI setup in rust/src/api.rs\n- Design document FFI examples (design.md lines 78-112)\n\n**_Requirements**: Foundation for all features\n\n**Success**:\n- `flutter_rust_bridge_codegen generate` completes successfully\n- Rust compiles: `cargo build --release`\n- Dart analyzes: `flutter analyze` shows no new errors\n- Generated files committed\n\n**Instructions**:\n1. Mark this task as in-progress in tasks.md\n2. Run codegen and verify\n3. Log implementation with artifacts (files generated)\n4. Mark task complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 2: Storage Infrastructure (1 week)\n\n### Task 2.1: Implement Storage Service Interface\n**Estimate**: 2 hours\n**Priority**: Critical\n**Files**: `lib/services/storage/i_storage_service.dart`\n\n**Description**: Create interface for calibration and settings persistence.\n\n**Requirements**: US-1, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Service Layer Developer\n\n**Task**: Create IStorageService interface following existing patterns.\n\nInterface methods:\n```dart\nabstract class IStorageService {\n  Future<void> init();\n  Future<bool> hasCalibration();\n  Future<void> saveCalibration(CalibrationData data);\n  Future<CalibrationData?> loadCalibration();\n  Future<void> clearCalibration();\n}\n\nclass CalibrationData {\n  final int level;\n  final DateTime timestamp;\n  final Map<String, double> thresholds;\n\n  CalibrationData({\n    required this.level,\n    required this.timestamp,\n    required this.thresholds,\n  });\n\n  factory CalibrationData.fromJson(Map<String, dynamic> json);\n  Map<String, dynamic> toJson();\n}\n```\n\n**Restrictions**:\n- Follow existing service interface patterns (see IAudioService)\n- Use abstract class, not mixin\n- Document all methods with /// comments\n\n**_Leverage**:\n- lib/services/audio/i_audio_service.dart (interface pattern)\n- Design document section 1.1 (design.md lines 117-141)\n\n**_Requirements**: US-1 (calibration persistence), US-4 (level storage)\n\n**Success**:\n- File created at lib/services/storage/i_storage_service.dart\n- Interface defines all 5 methods\n- CalibrationData class includes fromJson/toJson\n- No syntax errors: `dart analyze lib/services/storage/`\n\n**Instructions**:\n1. Mark task in-progress in tasks.md\n2. Create interface file\n3. Log implementation with artifacts (interface definition)\n4. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 2.2: Implement Storage Service\n**Estimate**: 4 hours\n**Priority**: Critical\n**Files**: `lib/services/storage/storage_service_impl.dart`\n\n**Description**: Implement storage service using shared_preferences.\n\n**Requirements**: US-1, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Service Implementation Developer\n\n**Task**: Implement StorageServiceImpl with shared_preferences.\n\nImplementation requirements:\n- Initialize SharedPreferences in init()\n- Store calibration as JSON string with key 'calibration_data'\n- Handle serialization/deserialization errors gracefully\n- Use proper error types (StorageException)\n\nStorage keys:\n- 'calibration_data': JSON string of CalibrationData\n- 'has_calibration': bool flag\n\n**Restrictions**:\n- Must call init() before using (async initialization pattern)\n- Handle null cases (no data saved)\n- Use try-catch for JSON parsing\n- Follow existing service implementation patterns\n\n**_Leverage**:\n- lib/services/audio/audio_service_impl.dart (implementation pattern)\n- Task 2.1 interface definition\n- Design document section 1.1 (design.md lines 142-152)\n\n**_Requirements**: US-1 (calibration persistence), US-4 (settings storage)\n\n**Success**:\n- File created at lib/services/storage/storage_service_impl.dart\n- Implements IStorageService\n- All methods work with SharedPreferences\n- Error handling for JSON parsing\n- No analyzer errors\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Implement class with proper error handling\n3. Log with artifacts (class definition, methods)\n4. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 2.3: Add Storage Service Tests\n**Estimate**: 3 hours\n**Priority**: High\n**Files**: `test/services/storage_service_test.dart`\n\n**Description**: Unit tests for storage service with mock SharedPreferences.\n\n**Requirements**: US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Test Engineer\n\n**Task**: Write comprehensive unit tests for StorageServiceImpl.\n\nTest cases:\n1. hasCalibration returns false when no data\n2. saveCalibration and loadCalibration round-trip\n3. clearCalibration removes data\n4. JSON parsing error handling\n5. Null handling for missing data\n\nUse SharedPreferences.setMockInitialValues({}) for testing.\n\n**Restrictions**:\n- Do NOT use real file system\n- Use MockInitialValues pattern for SharedPreferences\n- Follow existing test patterns (mocktail)\n- Aim for 100% code coverage of storage service\n\n**_Leverage**:\n- test/services/audio_service_test.dart (test pattern)\n- Design document section 6.3 (design.md lines 568-606)\n- Task 2.2 implementation\n\n**_Requirements**: US-5 (80%+ test coverage)\n\n**Success**:\n- File created at test/services/storage_service_test.dart\n- All 5+ test cases pass\n- Coverage of storage_service_impl.dart is 100%\n- Tests run in <3 seconds\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Write tests with proper assertions\n3. Run: `flutter test test/services/storage_service_test.dart`\n4. Log with artifacts (test cases)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 2.4: Add Rust Calibration Persistence API\n**Estimate**: 3 hours\n**Priority**: Critical\n**Files**: `rust/src/api.rs`, `rust/src/context.rs`\n\n**Description**: Add FFI methods to load/save calibration state from JSON.\n\n**Requirements**: US-1, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Rust FFI/Backend Developer\n\n**Task**: Add FFI methods for calibration persistence.\n\nNew FFI methods to add to rust/src/api.rs:\n```rust\n#[flutter_rust_bridge::frb]\npub fn load_calibration_state(json: String) -> Result<(), CalibrationError> {\n    let data: CalibrationData = serde_json::from_str(&json)?;\n    APP_CONTEXT.load_calibration(data)?;\n    Ok(())\n}\n\n#[flutter_rust_bridge::frb]\npub fn get_calibration_state() -> Result<String, CalibrationError> {\n    let data = APP_CONTEXT.get_calibration_state()?;\n    Ok(serde_json::to_string(&data)?)\n}\n```\n\nAlso update CalibrationState struct to include `level` field.\n\n**Restrictions**:\n- Use serde_json for serialization\n- Return proper CalibrationError types\n- Do NOT use unwrap() or expect()\n- Add serde Serialize/Deserialize derives\n\n**_Leverage**:\n- rust/src/api.rs existing patterns\n- rust/src/calibration/state.rs\n- Design document section 1.1 (design.md lines 153-169)\n\n**_Requirements**: US-1 (load calibration on app start), US-4 (level persistence)\n\n**Success**:\n- Two new FFI methods in api.rs\n- CalibrationState has `level: u8` field\n- Rust compiles without errors\n- FFI bridge regenerates successfully\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add methods and regenerate FFI bridge\n3. Test Rust compilation\n4. Log with artifacts (API methods, struct changes)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 3: Navigation & Onboarding (1 week)\n\n### Task 3.1: Configure go_router Navigation\n**Estimate**: 2 hours\n**Priority**: Critical\n**Files**: `lib/main.dart`\n\n**Description**: Replace MaterialApp with MaterialApp.router and define routes.\n\n**Requirements**: US-1\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Navigation Developer\n\n**Task**: Configure go_router for app navigation.\n\nRoutes to define:\n- `/` → SplashScreen (checks calibration)\n- `/onboarding` → OnboardingScreen\n- `/calibration` → CalibrationScreen\n- `/training` → TrainingScreen\n- `/settings` → SettingsScreen\n\nReplace existing MaterialApp with MaterialApp.router.\n\n**Restrictions**:\n- Keep existing theme configuration\n- Do NOT break existing TrainingScreen\n- Use context.go() for navigation (not Navigator.push)\n\n**_Leverage**:\n- lib/main.dart current structure\n- Design document section 1.2 (design.md lines 172-202)\n\n**_Requirements**: US-1 (onboarding flow navigation)\n\n**Success**:\n- main.dart uses MaterialApp.router\n- All 5 routes defined\n- App compiles and launches\n- No navigation errors in logs\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Update main.dart with router config\n3. Test navigation manually\n4. Log with artifacts (router configuration)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 3.2: Implement Splash Screen\n**Estimate**: 3 hours\n**Priority**: Critical\n**Files**: `lib/ui/screens/splash_screen.dart`\n\n**Description**: Create splash screen that checks calibration and routes accordingly.\n\n**Requirements**: US-1\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI Developer\n\n**Task**: Create SplashScreen with calibration check logic.\n\nFlow:\n1. Show app logo/loading indicator\n2. Initialize StorageService\n3. Check hasCalibration()\n4. If true: load calibration into Rust, navigate to /training\n5. If false: navigate to /onboarding\n\n**Restrictions**:\n- Use StatefulWidget with initState for checks\n- Handle errors gracefully (show error dialog)\n- Inject IStorageService for testability\n- Show loading indicator while checking\n\n**_Leverage**:\n- lib/ui/screens/training_screen.dart (StatefulWidget pattern)\n- Task 2.2 StorageService implementation\n- Design document section 1.2 (design.md lines 204-232)\n\n**_Requirements**: US-1 (first-time user detection)\n\n**Success**:\n- File created at lib/ui/screens/splash_screen.dart\n- Checks calibration on mount\n- Routes to correct screen based on state\n- Shows loading indicator\n- Handles errors with ErrorDialog\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create splash screen with routing logic\n3. Test both paths (calibrated/not calibrated)\n4. Log with artifacts (screen component, routing logic)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 3.3: Implement Onboarding Screen\n**Estimate**: 4 hours\n**Priority**: High\n**Files**: `lib/ui/screens/onboarding_screen.dart`\n\n**Description**: Create friendly onboarding screen explaining calibration.\n\n**Requirements**: US-1\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI/UX Developer\n\n**Task**: Create OnboardingScreen with welcoming design.\n\nUI elements:\n- App logo/icon (large)\n- Welcome message\n- Explanation of calibration purpose\n- 3-step visual guide (KICK → SNARE → HI-HAT)\n- \"Start Calibration\" button\n\n**Restrictions**:\n- Use Material Design 3 components\n- Follow existing color scheme (deepPurple)\n- Make text readable and friendly\n- Button navigates to /calibration\n\n**_Leverage**:\n- lib/ui/screens/training_screen.dart (UI patterns)\n- Design document section 1.2 (design.md lines 234-291)\n\n**_Requirements**: US-1 (onboarding experience)\n\n**Success**:\n- File created at lib/ui/screens/onboarding_screen.dart\n- Clear explanation of calibration\n- Visual step indicators\n- Button navigates to calibration\n- Matches design mockup\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create onboarding UI\n3. Test navigation flow\n4. Log with artifacts (UI component)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 3.4: Enhance Calibration Screen with Persistence\n**Estimate**: 3 hours\n**Priority**: Critical\n**Files**: `lib/ui/screens/calibration_screen.dart`\n\n**Description**: Modify existing calibration screen to save data on completion.\n\n**Requirements**: US-1\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Integration Developer\n\n**Task**: Enhance CalibrationScreen to persist calibration data.\n\nChanges needed:\n1. Inject IStorageService\n2. After finish_calibration() succeeds:\n   - Call api.getCalibrationState()\n   - Deserialize JSON to CalibrationData\n   - Call storageService.saveCalibration(data)\n3. Show success dialog\n4. Navigate to /training\n\n**Restrictions**:\n- Do NOT break existing calibration logic\n- Handle save errors gracefully\n- Keep existing UI/UX\n- Use existing error handling patterns\n\n**_Leverage**:\n- lib/ui/screens/calibration_screen.dart (existing implementation)\n- Task 2.2 StorageService\n- Task 2.4 Rust API methods\n- Design document section 1.3 (design.md lines 293-339)\n\n**_Requirements**: US-1 (calibration persistence)\n\n**Success**:\n- CalibrationScreen saves data on completion\n- Success dialog shows before navigation\n- Data persists across app restarts\n- No errors in logs\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Modify _finishCalibration method\n3. Test full calibration flow\n4. Verify data persists (check storage)\n5. Log with artifacts (modified methods)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 4: Settings & Configuration (1 week)\n\n### Task 4.1: Implement Settings Service Interface\n**Estimate**: 1 hour\n**Priority**: High\n**Files**: `lib/services/settings/i_settings_service.dart`\n\n**Description**: Create interface for app settings (BPM, debug mode, classifier level).\n\n**Requirements**: US-3, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Service Layer Developer\n\n**Task**: Create ISettingsService interface.\n\nMethods to define:\n```dart\nabstract class ISettingsService {\n  Future<void> init();\n  Future<int> getBpm();\n  Future<void> setBpm(int bpm);\n  Future<bool> getDebugMode();\n  Future<void> setDebugMode(bool enabled);\n  Future<int> getClassifierLevel();\n  Future<void> setClassifierLevel(int level);\n}\n```\n\n**Restrictions**:\n- Follow existing interface patterns\n- Document all methods\n- Use abstract class\n\n**_Leverage**:\n- Task 2.1 IStorageService (interface pattern)\n- Design document section 4 (design.md lines 504-528)\n\n**_Requirements**: US-3 (debug mode), US-4 (level selection)\n\n**Success**:\n- File created at lib/services/settings/i_settings_service.dart\n- Interface defines all 7 methods\n- No syntax errors\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create interface file\n3. Log with artifacts (interface)\n4. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 4.2: Implement Settings Service\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `lib/services/settings/settings_service_impl.dart`\n\n**Description**: Implement settings service with shared_preferences.\n\n**Requirements**: US-3, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Service Implementation Developer\n\n**Task**: Implement SettingsServiceImpl.\n\nStorage keys and defaults:\n- 'default_bpm': 120\n- 'debug_mode': false\n- 'classifier_level': 1\n\nUse SharedPreferences, similar to StorageServiceImpl pattern.\n\n**Restrictions**:\n- Must call init() before use\n- Provide sensible defaults\n- Validate input (BPM 40-240, level 1-2)\n\n**_Leverage**:\n- Task 2.2 StorageServiceImpl (implementation pattern)\n- Task 4.1 ISettingsService interface\n- Design document section 4 (design.md lines 529-548)\n\n**_Requirements**: US-3 (debug mode persistence), US-4 (level persistence)\n\n**Success**:\n- File created at lib/services/settings/settings_service_impl.dart\n- Implements ISettingsService\n- All methods use SharedPreferences correctly\n- Input validation present\n- No analyzer errors\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Implement with proper validation\n3. Log with artifacts (class, methods, validation logic)\n4. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 4.3: Create Settings Screen UI\n**Estimate**: 6 hours\n**Priority**: High\n**Files**: `lib/ui/screens/settings_screen.dart`\n\n**Description**: Build settings screen with all configuration options.\n\n**Requirements**: US-3, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI Developer\n\n**Task**: Create SettingsScreen with all settings.\n\nUI sections:\n1. Default BPM slider (40-240)\n2. Debug Mode switch\n3. Classifier Level switch (Beginner/Advanced)\n   - Show recalibration warning dialog on change\n4. Recalibrate button\n\n**Restrictions**:\n- Use ListView for scrollable settings\n- Follow Material Design patterns\n- Inject ISettingsService and IStorageService\n- Handle recalibration flow (clear data, navigate)\n\n**_Leverage**:\n- lib/ui/screens/training_screen.dart (UI patterns)\n- Task 4.2 SettingsServiceImpl\n- Task 2.2 StorageServiceImpl (for clearing calibration)\n- Design document section 4 (design.md lines 549-650)\n\n**_Requirements**: US-3 (debug toggle), US-4 (level selection, recalibrate)\n\n**Success**:\n- File created at lib/ui/screens/settings_screen.dart\n- All 4 settings functional\n- Recalibration warning dialog shows\n- Settings persist across restarts\n- Navigates to /calibration when recalibrating\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create settings UI with all sections\n3. Test each setting\n4. Verify persistence\n5. Log with artifacts (UI component, dialogs)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 4.4: Add Settings Navigation\n**Estimate**: 1 hour\n**Priority**: Medium\n**Files**: `lib/ui/screens/training_screen.dart`\n\n**Description**: Add settings button to TrainingScreen AppBar.\n\n**Requirements**: US-3, US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI Integration Developer\n\n**Task**: Add settings button to TrainingScreen.\n\nChanges:\n- Add IconButton to AppBar actions\n- Icon: Icons.settings\n- OnPressed: context.go('/settings')\n\n**Restrictions**:\n- Do NOT modify existing AppBar title/style\n- Keep minimal changes\n\n**_Leverage**:\n- lib/ui/screens/training_screen.dart (existing AppBar)\n- Task 4.3 SettingsScreen\n- Design document navigation examples\n\n**_Requirements**: US-3, US-4 (access settings)\n\n**Success**:\n- Settings icon in AppBar\n- Tapping navigates to /settings\n- Can navigate back to training\n- No UI regressions\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add settings button to AppBar\n3. Test navigation\n4. Log with artifacts (AppBar modification)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 5: Debug Mode System (1 week)\n\n### Task 5.1: Add Rust Debug Streams API\n**Estimate**: 4 hours\n**Priority**: High\n**Files**: `rust/src/api.rs`, `rust/src/audio/mod.rs`\n\n**Description**: Add FFI streams for audio metrics and onset events.\n\n**Requirements**: US-3\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Rust FFI/Backend Developer\n\n**Task**: Add debug data streams to FFI API.\n\nNew structs and streams:\n```rust\n#[derive(Clone, serde::Serialize, serde::Deserialize)]\npub struct AudioMetrics {\n    pub rms: f64,\n    pub spectral_centroid: f64,\n    pub spectral_flux: f64,\n    pub frame_number: u64,\n    pub timestamp: u64,\n}\n\n#[derive(Clone, serde::Serialize, serde::Deserialize)]\npub struct OnsetEvent {\n    pub timestamp: u64,\n    pub energy: f64,\n    pub features: AudioFeatures,\n    pub classification: Option<ClassificationResult>,\n}\n\n#[flutter_rust_bridge::frb]\npub fn audio_metrics_stream(sink: StreamSink<AudioMetrics>) {\n    TOKIO_RUNTIME.spawn(async move {\n        let stream = APP_CONTEXT.audio_metrics_stream().await;\n        tokio::pin!(stream);\n        while let Some(metrics) = stream.next().await {\n            sink.add(metrics);\n        }\n    });\n}\n\n#[flutter_rust_bridge::frb]\npub fn onset_events_stream(sink: StreamSink<OnsetEvent>) {\n    // Similar pattern\n}\n```\n\nAlso update AppContext to provide these streams.\n\n**Restrictions**:\n- Use same pattern as classification_stream\n- Do NOT block audio thread\n- Use broadcast channels for multiple subscribers\n- Add derives for serde\n\n**_Leverage**:\n- rust/src/api.rs existing stream patterns (classification_stream)\n- rust/src/context.rs (AppContext broadcast channels)\n- Design document section 3.1 (design.md lines 362-413)\n\n**_Requirements**: US-3 (debug data streams)\n\n**Success**:\n- Two new FFI stream methods in api.rs\n- AudioMetrics and OnsetEvent structs defined\n- Streams forward data from audio engine\n- FFI bridge regenerates successfully\n- Rust compiles\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add structs and stream methods\n3. Update AppContext to provide streams\n4. Regenerate FFI bridge\n5. Test Rust compilation\n6. Log with artifacts (API methods, structs)\n7. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 5.2: Implement Debug Service Interface\n**Estimate**: 1 hour\n**Priority**: High\n**Files**: `lib/services/debug/i_debug_service.dart`\n\n**Description**: Create interface for debug data access.\n\n**Requirements**: US-3\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Service Layer Developer\n\n**Task**: Create IDebugService interface.\n\nMethods:\n```dart\nabstract class IDebugService {\n  Stream<AudioMetrics> getAudioMetricsStream();\n  Stream<OnsetEvent> getOnsetEventsStream();\n  Future<String> exportLogs();\n}\n```\n\nAlso define Dart classes matching Rust structs (AudioMetrics, OnsetEvent).\n\n**Restrictions**:\n- Follow existing interface patterns\n- Match Rust struct fields exactly\n- Document all methods\n\n**_Leverage**:\n- Task 2.1 IStorageService (interface pattern)\n- Task 5.1 Rust structs\n- Design document section 3.1 (design.md lines 345-375)\n\n**_Requirements**: US-3 (debug data access)\n\n**Success**:\n- File created at lib/services/debug/i_debug_service.dart\n- Interface defines 3 methods\n- Dart classes match Rust structs\n- No syntax errors\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create interface and data classes\n3. Log with artifacts (interface, data models)\n4. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 5.3: Implement Debug Service\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `lib/services/debug/debug_service_impl.dart`\n\n**Description**: Implement debug service wrapping FFI debug streams.\n\n**Requirements**: US-3\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Service Implementation Developer\n\n**Task**: Implement DebugServiceImpl.\n\nImplementation:\n- getAudioMetricsStream(): call api.audioMetricsStream()\n- getOnsetEventsStream(): call api.onsetEventsStream()\n- exportLogs(): serialize recent events to JSON file\n\n**Restrictions**:\n- Follow existing service patterns\n- Handle stream errors gracefully\n- Limit log buffer size (last 1000 events)\n\n**_Leverage**:\n- Task 5.1 Rust FFI methods\n- Task 5.2 IDebugService interface\n- lib/services/audio/audio_service_impl.dart (FFI call pattern)\n- Design document section 3.1\n\n**_Requirements**: US-3 (debug functionality)\n\n**Success**:\n- File created at lib/services/debug/debug_service_impl.dart\n- Implements IDebugService\n- Streams forward FFI data\n- exportLogs creates JSON file\n- No errors\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Implement service with stream forwarding\n3. Test stream subscription\n4. Log with artifacts (class, methods)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 5.4: Create Debug Overlay Widget\n**Estimate**: 6 hours\n**Priority**: High\n**Files**: `lib/ui/widgets/debug_overlay.dart`\n\n**Description**: Build debug overlay UI with real-time metrics.\n\n**Requirements**: US-3\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI Developer\n\n**Task**: Create DebugOverlay widget with real-time debug UI.\n\nUI components:\n1. Header with \"Debug Metrics\" and close button\n2. Audio metrics section:\n   - RMS level (numerical + bar meter)\n   - Spectral centroid\n   - Spectral flux\n   - Frame number\n3. Onset events log (scrollable list, last 10 events)\n\nUse Stack widget to overlay on top of main content.\n\n**Restrictions**:\n- Use semi-transparent black background (0.85 opacity)\n- Do NOT block touches to underlying UI (use Positioned correctly)\n- StreamBuilder for reactive updates\n- Inject IDebugService\n\n**_Leverage**:\n- lib/ui/widgets/loading_overlay.dart (overlay pattern)\n- Task 5.3 DebugServiceImpl\n- Design document section 3.2 (design.md lines 415-497)\n\n**_Requirements**: US-3 (debug visualization)\n\n**Success**:\n- File created at lib/ui/widgets/debug_overlay.dart\n- Displays all metrics in real-time\n- RMS level meter animates\n- Onset events log scrolls\n- Close button dismisses overlay\n- No performance impact on audio\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create overlay widget with all sections\n3. Test with debug mode enabled\n4. Verify real-time updates\n5. Log with artifacts (UI component, meters)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 5.5: Integrate Debug Overlay into TrainingScreen\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `lib/ui/screens/training_screen.dart`\n\n**Description**: Add debug overlay toggle to training screen.\n\n**Requirements**: US-3\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Integration Developer\n\n**Task**: Integrate DebugOverlay into TrainingScreen.\n\nChanges:\n1. Load debug mode setting from ISettingsService on init\n2. If debug mode enabled, wrap build output with DebugOverlay\n3. Add toggle in AppBar (debug icon)\n4. Pass IDebugService to overlay\n\n**Restrictions**:\n- Do NOT always show overlay (only when enabled)\n- Inject ISettingsService and IDebugService\n- Keep existing training UI unchanged\n\n**_Leverage**:\n- Task 5.4 DebugOverlay widget\n- Task 4.2 SettingsServiceImpl\n- lib/ui/screens/training_screen.dart\n- Design document section 3.3 (design.md lines 499-535)\n\n**_Requirements**: US-3 (debug mode integration)\n\n**Success**:\n- Debug overlay appears when enabled in settings\n- Toggle button in AppBar\n- Overlay shows real-time data\n- No impact when disabled\n- Settings persistence works\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add debug mode state and overlay logic\n3. Test toggle functionality\n4. Verify data flows correctly\n5. Log with artifacts (integration logic)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 6: Real-Time Feedback Enhancements (3 days)\n\n### Task 6.1: Add Confidence Score to Rust Classifier\n**Estimate**: 3 hours\n**Priority**: Medium\n**Files**: `rust/src/analysis/classifier.rs`, `rust/src/analysis/mod.rs`\n\n**Description**: Calculate and return confidence scores with classifications.\n\n**Requirements**: US-2\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Rust Audio/ML Developer\n\n**Task**: Add confidence score calculation to Classifier.\n\nChanges:\n1. Add `confidence: f32` field to ClassificationResult struct\n2. In classify_level1(), compute confidence as:\n   - max_score / (sum of all scores)\n   - Clamp to 0.0-1.0\n3. Similarly for classify_level2()\n\n**Restrictions**:\n- Do NOT change classification logic\n- Confidence must be normalized 0.0-1.0\n- Handle edge cases (all zeros = 0.0 confidence)\n\n**_Leverage**:\n- rust/src/analysis/classifier.rs (existing classification)\n- rust/src/analysis/mod.rs (ClassificationResult struct)\n- Design document section 2.2 (design.md lines 440-474)\n\n**_Requirements**: US-2 (confidence display)\n\n**Success**:\n- ClassificationResult has confidence field\n- Confidence calculated in both level 1 and 2\n- Values between 0.0 and 1.0\n- Rust compiles, FFI regenerates\n- Existing tests still pass\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add confidence field and calculation\n3. Regenerate FFI bridge\n4. Run Rust tests: `cargo test`\n5. Log with artifacts (struct modification, calculation logic)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 6.2: Enhance Classification Display with Confidence\n**Estimate**: 3 hours\n**Priority**: Medium\n**Files**: `lib/ui/screens/training_screen.dart`\n\n**Description**: Add confidence meter and fade animation to classification feedback.\n\n**Requirements**: US-2\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI/Animation Developer\n\n**Task**: Enhance classification display with confidence and animations.\n\nAdditions:\n1. AnimationController for fade-out effect (500ms)\n2. Confidence meter below timing feedback:\n   - Progress bar (0-100%)\n   - Color-coded: green >80%, orange 50-80%, red <50%\n   - Percentage label\n3. Restart animation on each new result\n\n**Restrictions**:\n- Use SingleTickerProviderStateMixin for animation\n- Do NOT break existing sound/timing display\n- Dispose animation controller properly\n- Keep animations smooth (60fps)\n\n**_Leverage**:\n- lib/ui/screens/training_screen.dart (existing display)\n- Task 6.1 confidence field in ClassificationResult\n- Design document section 2.1 (design.md lines 341-423)\n\n**_Requirements**: US-2 (enhanced feedback with confidence)\n\n**Success**:\n- Classification display includes confidence meter\n- Feedback fades out over 500ms\n- Confidence bar animates smoothly\n- Color coding works correctly\n- No jank or dropped frames\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add AnimationController and confidence widget\n3. Test with various confidence values\n4. Verify smooth animations\n5. Log with artifacts (animation code, confidence widget)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 7: Classifier Level Selection (3 days)\n\n### Task 7.1: Add Level Field to Rust CalibrationState\n**Estimate**: 2 hours\n**Priority**: Medium\n**Files**: `rust/src/calibration/state.rs`, `rust/src/analysis/classifier.rs`\n\n**Description**: Add level field and implement level 2 classification logic.\n\n**Requirements**: US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Rust Audio/Classification Developer\n\n**Task**: Add classifier level support to Rust backend.\n\nChanges:\n1. Add `level: u8` to CalibrationState struct\n2. Add level 2 thresholds (closed_hihat, open_hihat, ksnare)\n3. Implement classify_level2() method:\n   - 6 categories: Kick, Snare, ClosedHiHat, OpenHiHat, KSnare, Silence\n   - Use additional spectral features for subcategories\n4. Update classify() to dispatch based on level\n\n**Restrictions**:\n- Do NOT break existing level 1 logic\n- Level defaults to 1 if not specified\n- Add proper serde derives\n- Level 2 logic can be simplified for UAT (refinement later)\n\n**_Leverage**:\n- rust/src/calibration/state.rs\n- rust/src/analysis/classifier.rs (classify_level1 pattern)\n- Design document section 5 (design.md lines 653-686)\n\n**_Requirements**: US-4 (advanced mode)\n\n**Success**:\n- CalibrationState has level field\n- classify() dispatches based on level\n- classify_level2() implemented (even if simple)\n- Rust compiles, tests pass\n- FFI bridge regenerates\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add level field and level 2 logic\n3. Run tests: `cargo test`\n4. Regenerate FFI\n5. Log with artifacts (struct changes, classify_level2 method)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 7.2: Update Settings Screen with Level Selection\n**Estimate**: 2 hours\n**Priority**: Medium\n**Files**: `lib/ui/screens/settings_screen.dart`\n\n**Description**: Add classifier level toggle with recalibration warning.\n\n**Requirements**: US-4\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter UI/UX Developer\n\n**Task**: Add classifier level selection to SettingsScreen.\n\nUI changes:\n- Add SwitchListTile for \"Advanced Mode\"\n- Title: \"Advanced Mode\"\n- Subtitle: Current level description\n  - Level 1: \"Beginner (3 categories: KICK, SNARE, HIHAT)\"\n  - Level 2: \"Advanced (6 categories with subcategories)\"\n- On change: show confirmation dialog warning about recalibration\n- If confirmed: save level, clear calibration, navigate to /calibration\n\n**Restrictions**:\n- Confirmation dialog is REQUIRED\n- Explain that switching requires recalibration\n- Do NOT allow switching without clearing calibration\n\n**_Leverage**:\n- Task 4.3 existing SettingsScreen\n- Task 2.2 StorageService (clearCalibration)\n- Task 4.2 SettingsService (setClassifierLevel)\n- Design document section 4 (design.md lines 583-646)\n\n**_Requirements**: US-4 (level selection, recalibration)\n\n**Success**:\n- Level toggle appears in settings\n- Confirmation dialog shows on change\n- Switching clears calibration and navigates\n- Level persists across restarts\n- UI shows correct level description\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Add level toggle with dialog\n3. Test switching between levels\n4. Verify recalibration flow\n5. Log with artifacts (toggle widget, dialog)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 8: Test Infrastructure (1 week)\n\n### Task 8.1: Create Test Mocks\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `test/mocks.dart`\n\n**Description**: Define all mock classes for testing.\n\n**Requirements**: US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Test Infrastructure Engineer\n\n**Task**: Create centralized mocks file.\n\nMocks needed:\n```dart\nclass MockAudioService extends Mock implements IAudioService {}\nclass MockStorageService extends Mock implements IStorageService {}\nclass MockSettingsService extends Mock implements ISettingsService {}\nclass MockDebugService extends Mock implements IDebugService {}\nclass MockPermissionService extends Mock implements IPermissionService {}\n```\n\n**Restrictions**:\n- Use mocktail library\n- One mock per service interface\n- Follow existing mock patterns\n\n**_Leverage**:\n- test/services/audio_service_test.dart (existing mock pattern)\n- All service interfaces (Tasks 2.1, 4.1, 5.2)\n- Design document section 6.2 (design.md lines 540-554)\n\n**_Requirements**: US-5 (test infrastructure)\n\n**Success**:\n- File created at test/mocks.dart\n- All 5 mocks defined\n- Mocks compile without errors\n- Can be imported in test files\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create mocks file\n3. Verify compilation\n4. Log with artifacts (mock definitions)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 8.2: Write Settings Service Tests\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `test/services/settings_service_test.dart`\n\n**Description**: Unit tests for SettingsServiceImpl.\n\n**Requirements**: US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Test Engineer\n\n**Task**: Write comprehensive tests for SettingsServiceImpl.\n\nTest cases:\n1. Default values returned when no data\n2. getBpm/setBpm persistence\n3. getDebugMode/setDebugMode persistence\n4. getClassifierLevel/setClassifierLevel persistence\n5. BPM validation (reject <40 or >240)\n6. Level validation (reject <1 or >2)\n\n**Restrictions**:\n- Use SharedPreferences.setMockInitialValues\n- Follow existing test patterns\n- Aim for 100% coverage of settings service\n\n**_Leverage**:\n- Task 2.3 storage service tests (test pattern)\n- Task 4.2 SettingsServiceImpl\n- Design document test examples\n\n**_Requirements**: US-5 (test coverage)\n\n**Success**:\n- File created at test/services/settings_service_test.dart\n- All 6+ test cases pass\n- Coverage of settings_service_impl.dart is 100%\n- Tests run in <3 seconds\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Write tests with assertions\n3. Run: `flutter test test/services/settings_service_test.dart`\n4. Log with artifacts (test cases)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 8.3: Write Widget Tests for New Screens\n**Estimate**: 6 hours\n**Priority**: High\n**Files**: Multiple test files\n\n**Description**: Widget tests for splash, onboarding, and settings screens.\n\n**Requirements**: US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Flutter Widget Test Engineer\n\n**Task**: Write widget tests for all new screens.\n\nTest files to create:\n1. test/ui/screens/splash_screen_test.dart\n   - Test navigation when calibration exists\n   - Test navigation when no calibration\n   - Test error handling\n2. test/ui/screens/onboarding_screen_test.dart\n   - Test UI renders correctly\n   - Test \"Start Calibration\" navigation\n3. test/ui/screens/settings_screen_test.dart\n   - Test all settings load correctly\n   - Test BPM change persists\n   - Test debug toggle persists\n   - Test level change shows dialog\n   - Test recalibrate button\n\n**Restrictions**:\n- Use testWidgets for each case\n- Mock all services (use Task 8.1 mocks)\n- Use MaterialApp wrapper for navigation context\n- Verify with tester.pump() and tester.pumpAndSettle()\n\n**_Leverage**:\n- test/ui/screens/training_screen_test.dart (widget test patterns)\n- Task 8.1 mocks\n- Design document section 6 (test patterns)\n\n**_Requirements**: US-5 (widget test coverage)\n\n**Success**:\n- 3 test files created\n- 10+ test cases total\n- All tests pass\n- Coverage increases by 15-20%\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Create all 3 test files\n3. Run: `flutter test test/ui/screens/`\n4. Log with artifacts (test files, test cases)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 8.4: Integration Test: Calibration Flow\n**Estimate**: 4 hours\n**Priority**: Medium\n**Files**: `test/integration/calibration_flow_test.dart`\n\n**Description**: End-to-end integration test for calibration flow.\n\n**Requirements**: US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Integration Test Engineer\n\n**Task**: Write integration test for full calibration flow.\n\nTest flow:\n1. Launch app (no calibration)\n2. Verify onboarding screen appears\n3. Tap \"Start Calibration\"\n4. Complete calibration (mock FFI)\n5. Verify data saved to storage\n6. Restart app\n7. Verify training screen appears (calibration loaded)\n\n**Restrictions**:\n- Use integration_test package\n- May need to mock FFI calls (Rust not available in tests)\n- Use real SharedPreferences (not mocked)\n- Clean up storage after test\n\n**_Leverage**:\n- Integration test documentation\n- All screens (Tasks 3.2, 3.3, 3.4)\n- Design document integration test notes\n\n**_Requirements**: US-5 (integration test coverage)\n\n**Success**:\n- File created at test/integration/calibration_flow_test.dart\n- Test completes entire flow\n- Test passes consistently\n- Storage cleanup works\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Write integration test\n3. Run: `flutter test integration_test/`\n4. Log with artifacts (test file, flow steps)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 8.5: Update Coverage Script and Verify 80% Threshold\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `scripts/coverage.sh`\n\n**Description**: Update coverage script to enforce 80% threshold.\n\n**Requirements**: US-5\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: DevOps/CI Engineer\n\n**Task**: Update coverage script with 80% threshold check.\n\nScript requirements:\n1. Run `flutter test --coverage`\n2. Filter out generated files (frb_generated, bridge_generated)\n3. Generate HTML report\n4. Extract coverage percentage\n5. Exit with error if <80%\n\n**Restrictions**:\n- Use lcov for filtering and reporting\n- Exclude generated Dart files\n- Exclude Rust generated files\n- Print clear pass/fail message\n\n**_Leverage**:\n- Existing scripts/coverage.sh (if present)\n- Design document section 6.4 (design.md lines 608-626)\n\n**_Requirements**: US-5 (80% coverage requirement)\n\n**Success**:\n- scripts/coverage.sh updated\n- Script exits 0 if ≥80%, exits 1 if <80%\n- HTML report generated in coverage/html\n- Clear output messages\n- Script is executable\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Update or create coverage script\n3. Run: `bash scripts/coverage.sh`\n4. Verify threshold check works\n5. Log with artifacts (script)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Phase 9: UAT Documentation & Execution (3 days)\n\n### Task 9.1: Create UAT Test Scenarios Document\n**Estimate**: 4 hours\n**Priority**: Critical\n**Files**: `.spec-workflow/specs/uat-readiness/UAT_TEST_SCENARIOS.md`\n\n**Description**: Document all UAT test scenarios with step-by-step instructions.\n\n**Requirements**: US-6\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: QA Documentation Specialist\n\n**Task**: Create comprehensive UAT test scenarios document.\n\nDocument structure:\n1. Test environment (devices, Android versions)\n2. 15+ test scenarios covering:\n   - First-time user onboarding\n   - Calibration flow\n   - Real-time classification feedback\n   - Debug mode\n   - Settings (BPM, debug, level, recalibrate)\n   - Persistence (calibration, settings)\n   - Error handling\n   - Performance benchmarks\n3. Each scenario has:\n   - Prerequisite\n   - Steps (numbered)\n   - Expected result\n   - Pass/Fail checkbox\n4. Performance benchmark table\n5. Sign-off section\n\n**Restrictions**:\n- Clear, step-by-step instructions\n- Testable by non-developers\n- Specific, measurable expectations\n- Include edge cases\n\n**_Leverage**:\n- requirements.md user stories\n- Design document UAT section (design.md lines 687-735)\n\n**_Requirements**: US-6 (UAT documentation)\n\n**Success**:\n- File created with 15+ scenarios\n- Each scenario is complete and testable\n- Performance benchmarks defined\n- Sign-off checklist present\n- Formatted in Markdown\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Write UAT scenarios document\n3. Review for completeness\n4. Log with artifacts (document)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 9.2: Execute UAT Scenarios on Test Devices\n**Estimate**: 8 hours (spread over 2 days)\n**Priority**: Critical\n**Files**: UAT_TEST_SCENARIOS.md (updated with results)\n\n**Description**: Run all UAT scenarios on 3 test devices and document results.\n\n**Requirements**: US-6\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: QA Tester\n\n**Task**: Execute all UAT scenarios on test devices.\n\nTest devices (minimum 3):\n1. Pixel 9a (primary test device)\n2. Another device (Samsung/OnePlus/Xiaomi)\n3. Another device (different manufacturer)\n\nFor each scenario:\n1. Follow steps exactly\n2. Record actual results\n3. Mark Pass/Fail\n4. Document any issues found\n5. Measure performance metrics\n\n**Restrictions**:\n- Test on clean installs (uninstall/reinstall)\n- Test with airplane mode for offline validation\n- Record any crashes or errors\n- Take screenshots of failures\n\n**_Leverage**:\n- Task 9.1 UAT scenarios document\n- Build APK: `flutter build apk --debug`\n- Install: `adb install build/app/outputs/flutter-apk/app-debug.apk`\n\n**_Requirements**: US-6 (UAT execution)\n\n**Success**:\n- All scenarios executed on 3 devices\n- Results documented in UAT_TEST_SCENARIOS.md\n- Performance benchmarks measured\n- Issues documented with repro steps\n- Sign-off complete if all pass\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Build and install APK on devices\n3. Execute all scenarios\n4. Update document with results\n5. Log with artifacts (test results, issues found)\n6. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 9.3: Fix Critical UAT Issues (if any)\n**Estimate**: Variable (1-3 days)\n**Priority**: Critical\n**Files**: Various (depends on issues)\n\n**Description**: Fix any critical bugs discovered during UAT.\n\n**Requirements**: All\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: Full-Stack Developer\n\n**Task**: Fix critical issues found during UAT execution.\n\nProcess:\n1. Review issues from Task 9.2\n2. Prioritize: Critical > High > Medium > Low\n3. Fix critical issues first\n4. Re-test affected scenarios\n5. Update UAT document with retest results\n\n**Restrictions**:\n- Only fix critical issues (crashes, data loss, blocking bugs)\n- Do NOT add new features\n- Maintain backward compatibility\n- Run existing tests after fixes\n\n**_Leverage**:\n- Task 9.2 issue reports\n- All existing code and tests\n- Design document troubleshooting guidance\n\n**_Requirements**: All (bug fixes)\n\n**Success**:\n- All critical issues resolved\n- No regressions introduced\n- Tests still pass\n- UAT scenarios now pass\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Fix each issue systematically\n3. Retest scenarios\n4. Log each fix with artifacts\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n### Task 9.4: Create UAT Sign-Off Report\n**Estimate**: 2 hours\n**Priority**: High\n**Files**: `.spec-workflow/specs/uat-readiness/UAT_SIGN_OFF_REPORT.md`\n\n**Description**: Summarize UAT results and provide sign-off recommendation.\n\n**Requirements**: US-6\n\n**_Prompt**:\n```\nImplement the task for spec uat-readiness, first run spec-workflow-guide to get the workflow guide then implement the task:\n\n**Role**: QA Lead\n\n**Task**: Create UAT sign-off report.\n\nReport contents:\n1. Executive Summary\n   - Overall pass/fail status\n   - Devices tested\n   - Test duration\n2. Test Results Summary\n   - Scenarios passed/failed\n   - Coverage of requirements\n3. Performance Benchmark Results\n   - Measured vs target for each metric\n4. Known Issues\n   - Remaining bugs (if any)\n   - Workarounds\n5. Recommendations\n   - Production readiness assessment\n   - Blockers (if any)\n6. Sign-Off\n   - QA approval\n   - Stakeholder approval section\n\n**Restrictions**:\n- Be objective and data-driven\n- Clearly state any blockers\n- Provide evidence (test results)\n- Professional formatting\n\n**_Leverage**:\n- Task 9.2 UAT results\n- Task 9.3 issue resolutions\n- requirements.md success criteria\n\n**_Requirements**: US-6 (UAT completion)\n\n**Success**:\n- Report created with all sections\n- Clear pass/fail recommendation\n- Data-driven assessment\n- Sign-off section present\n- Professional quality\n\n**Instructions**:\n1. Mark in-progress in tasks.md\n2. Write sign-off report\n3. Review with stakeholders (if applicable)\n4. Log with artifacts (report)\n5. Mark complete in tasks.md\n```\n\n**Status**: `[ ]`\n\n---\n\n## Summary\n\n**Total Tasks**: 31\n**Estimated Duration**: 4-5 weeks (1 developer)\n\n**Critical Path**:\n1. Foundation (Tasks 1.x) - 1 day\n2. Storage (Tasks 2.x) - 1 week\n3. Navigation & Onboarding (Tasks 3.x) - 1 week\n4. Settings (Tasks 4.x) - 1 week\n5. Debug Mode (Tasks 5.x) - 1 week\n6. Enhancements (Tasks 6.x, 7.x) - 1 week\n7. Testing (Tasks 8.x) - 1 week\n8. UAT (Tasks 9.x) - 3 days\n\n**Success Metrics**:\n- All 31 tasks completed\n- All tests passing (>80% coverage)\n- All UAT scenarios pass on 3 devices\n- Performance benchmarks met\n- Zero critical bugs\n\n**Next Steps**:\nOnce this tasks document is approved, you can begin implementation by:\n1. Reading each task's _Prompt section\n2. Marking task as in-progress (change [ ] to [-])\n3. Following the prompt instructions\n4. Using log-implementation tool after completion\n5. Marking task as complete (change [-] to [x])\n",
  "fileStats": {
    "size": 51117,
    "lines": 1951,
    "lastModified": "2025-11-13T12:37:14.092Z"
  },
  "comments": []
}